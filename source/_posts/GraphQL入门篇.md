---
title: GraphQLå…¥é—¨ç¯‡
date: 2024-01-29 10:00:00
tags: GraphQL
---

# èƒŒæ™¯
ä¼ ç»Ÿçš„RESTfulæ¥å£å¼€å‘ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ˜¯åå°å·¥ç¨‹å¸ˆä¸»å¯¼çš„ã€‚åå°å·¥ç¨‹å¸ˆæ ¹æ®å½“å‰è¿­ä»£çš„éœ€æ±‚ï¼Œè®¾è®¡éœ€è¦ç”¨åˆ°çš„è¡¨ã€ä»¥åŠå„è¡¨ç›¸å…³çš„å­—æ®µï¼Œç„¶åå’Œå‰ç«¯å·¥ç¨‹å¸ˆå•†å®šæ¯ä¸ªé¡µé¢ä¸Šçš„ä¸€äº›å…·ä½“çš„æ¥å£å­—æ®µå®šä¹‰ã€‚

è¿™ç§æƒ…å†µä¼šæœ‰å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼š
1. ä¸€ä¸ªæ¥å£å¯èƒ½å¤šç«¯éƒ½ä¼šç”¨åˆ°ï¼Œä¸åŒç«¯ç”¨åˆ°çš„æ¥å£è¿”å›å­—æ®µé›†åˆåˆä¸å¤ªä¸€æ ·ã€‚å¯¼è‡´å¯¹äºæ¯ä¸ªç«¯ï¼Œæ¥å£çš„å­—æ®µåˆ©ç”¨ç‡ä¸é«˜ï¼Œæ•°æ®ä¹Ÿä¸å®‰å…¨ã€‚
2. æ¥å£çš„ç²’åº¦å¦‚æœè¿‡ç»†ï¼Œä¸€ä¸ªé¡µé¢éœ€è¦è°ƒç”¨çš„æ¥å£æ•°é‡å°±ä¼šå˜å¤šï¼Œé¡µé¢åŠ è½½æ€§èƒ½ä¸‹é™ã€‚

æ˜¯å¦æœ‰ä¸€ç§æ–¹å¼ï¼Œå¯ä»¥è®©å‰ç«¯å¯ä»¥`æŒ‰éœ€`è·å–æƒ³è¦çš„å­—æ®µï¼Œè€Œåå°èƒ½å¤Ÿç²¾å‡†è¿”å›å‰ç«¯éœ€è¦å­—æ®µå‘¢ï¼Œä¸”æ— å†—ä½™ä¿¡æ¯ï¼Ÿ
ç­”æ¡ˆæ˜¯æœ‰çš„ã€‚Facebook äº 2015 å¹´å¼€æºäº† GraphQL è§„èŒƒï¼Œè®©å‰ç«¯è‡ªå·±æè¿°è‡ªå·±å¸Œæœ›çš„æ•°æ®å½¢å¼ï¼ŒæœåŠ¡ç«¯åˆ™è¿”å›å‰ç«¯æ‰€æè¿°çš„æ•°æ®ç»“æ„ã€‚


# RESTfulæ¥å£
å‡è®¾æœ‰ä¸€ä¸ªè¡¨ï¼Œå­˜å‚¨æ‰€æœ‰å­¦ç”Ÿçš„åŸºæœ¬ä¿¡æ¯ã€‚åŒ…æ‹¬å­¦å·ã€å§“åã€å¹´é¾„ã€æ€§åˆ«ã€ç”µè¯ã€åœ°å€ã€ä¸ªäººä»‹ç»ï¼ˆæ•°æ®ç”±chatgptç”Ÿæˆï¼Œå¦‚æœé›·åŒï¼Œçº¯å±å·§åˆï¼‰ã€‚
![](https://dsweiblog.oss-cn-shanghai.aliyuncs.com/technote/SCR-20240128-tp3.png)

å‡å¦‚æŸå¤©éœ€è¦å¼€å‘ä¸€ä¸ªå­¦ç”Ÿçš„è”ç³»æ–¹å¼åˆ—è¡¨ï¼Œåˆ—è¡¨æ¡ç›®å±•ç¤ºä¿¡æ¯æœ‰çš„: å­¦å·ã€å§“åã€è”ç³»æ–¹å¼ã€‚ä¸ºæ­¤æ¥å£è®¾è®¡å¦‚ä¸‹ï¼š
```js
GET: /students/contactList // è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨æ¯ä¸ªå…ƒç´ æœ‰idã€nameã€phoneä¸‰ä¸ªå­—æ®µ
```
è¿‡äº†å‡ å¤©ï¼Œéœ€è¦å¼€å‘ä¸€ä¸ªå­¦ç”Ÿçš„å®¶åº­ä½å€åˆ—è¡¨é¡µé¢ï¼Œåˆ—è¡¨æ¡ç›®å±•ç¤ºæœ‰ï¼šå­¦å·ã€å§“åã€åœ°å€ã€‚ä¸ºæ­¤åå°ç§‰ç€åªè¿”å›å‰ç«¯å¿…è¦ä¿¡æ¯çš„åŸåˆ™ï¼Œè®¾è®¡äº†æ–°æ¥å£:
```js
GET: /students/addressList // è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨æ¯ä¸ªå…ƒç´ æœ‰idã€nameã€addressä¸‰ä¸ªå­—æ®µ
```

åˆè¿‡äº†å‡ å¤©ï¼Œéœ€è¦å¼€å‘ä¸€ä¸ªå­¦ç”Ÿæ€§åˆ«çš„æ˜ç»†åˆ—è¡¨ï¼Œæ¥å£å¦‚ä¸‹ï¼š
```js
GET: /students/genderList // è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨æ¯ä¸ªå…ƒç´ æœ‰idã€nameã€genderä¸‰ä¸ªå­—æ®µ
```

ä»¥ä¸Šä»…ä»…æ˜¯ä¸€ä¸ªå­¦ç”Ÿåˆ—è¡¨çš„ä¿¡æ¯çš„å¤„ç†ï¼Œåå°å°±éœ€è¦å®ç°ä¸‰ä¸ªä¸åŒçš„æ¥å£ï¼Œæ¥åº”ä»˜å‰ç«¯ä¸åŒéœ€æ±‚åœºæ™¯ä¸‹çš„æ•°æ®éœ€æ±‚ã€‚å¦‚æœæ¶‰åŠçš„è¡¨å’Œå­—æ®µæ›´å¤šæ ·ï¼Œé‚£æƒ…å†µå°±ä¼šå˜å¾—æ›´å¤æ‚ï¼Œéœ€è¦è®¾è®¡çš„æ¥å£ä¹Ÿä¼šæ›´å¤šï¼ˆå½“ç„¶å¦å¤–ä¸€ç§å¤„ç†æ–¹å¼å°±æ˜¯åå°ä¸ç®¡ä»€ä¹ˆåœºæ™¯ï¼Œå°†å­¦ç”Ÿè¡¨æ‰€æœ‰çš„å­—æ®µä¿¡æ¯éƒ½è¿”å›ã€‚è¿™æ ·æ˜¯èƒ½å¤Ÿé™ä½å¼€å‘æ¥å£çš„æ•°é‡ï¼Œä½†åˆä¼šå­˜åœ¨æ¯ä¸ªæ¥å£ä¿¡æ¯å†—ä½™çš„é—®é¢˜ï¼‰ã€‚

# GraphQLæ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ
æƒ³è¦çŸ¥é“GraphQLæ˜¯å¦‚ä½•è§£å†³RESTfulé¢ä¸´çš„é—®é¢˜ï¼Œå¯ä»¥æ€è€ƒç¬¬ä¸€æ®µä¸­è¯´çš„ï¼š
> GraphQLè®©å‰ç«¯è‡ªå·±æè¿°è‡ªå·±å¸Œæœ›çš„æ•°æ®å½¢å¼ï¼ŒæœåŠ¡ç«¯åˆ™è¿”å›å‰ç«¯æ‰€æè¿°çš„æ•°æ®ç»“æ„ã€‚

è¿˜æ˜¯ä»¥ä¸Šä¸€èŠ‚çš„ä¾‹å­ï¼Œè¿”å›å­¦ç”Ÿè”ç³»æ–¹å¼åˆ—è¡¨ï¼ŒGraphQLè®©å‰ç«¯åˆ©ç”¨å¦‚ä¸‹æ ¼å¼æè¿°è‡ªå·±éœ€è¦çš„å­—æ®µå’Œä¿¡æ¯ï¼š
```ts
query {
    students {
        id
        name
        phone
    }
}
```
ä¸Šé¢çš„æ ¼å¼ä¸­ï¼Œqueryè¡¨ç¤ºä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚ï¼ŒæŸ¥è¯¢çš„å†…å®¹æ˜¯studentsï¼ŒæŸ¥è¯¢çš„å­—æ®µåŒ…å«idã€nameã€phoneä¸‰ä¸ªå­—æ®µï¼Œå…¶ä»–ä¿¡æ¯ä¸éœ€è¦è¿”å›ã€‚

åå°è¿”å›æ•°æ®å¦‚ä¸‹
```ts
"students": [
  {
    "id": "1",
    "name": "å¼ ä¸‰",
    "phone": "13888888888",
  },
  ...
]
```
å¦‚æœæ˜¯è¿”å›å­¦ç”Ÿåœ°å€ä¿¡æ¯åˆ—è¡¨ï¼Œåˆ™å‰ç«¯æè¿°å¦‚ä¸‹ï¼š
```ts
query {
    students {
        id
        name
        address
    }
}
```
åå°è¿”å›
```ts
"students": [
  {
    "id": "1",
    "name": "å¼ ä¸‰",
    "address": "åŒ—äº¬å¸‚æœé˜³åŒºå»ºå›½é—¨å¤–å¤§è¡—18å·æ’åŸºä¸­å¿ƒBåº§2305å®¤\n",
  },
  ...
]
```
å¯ä»¥çœ‹åˆ°ï¼Œå‰ç«¯é€šè¿‡æ§åˆ¶éœ€è¦çš„å­—æ®µï¼Œæ¥è®©åå°è¿”å›ç›¸åº”å­—æ®µçš„æ•°æ®ã€‚æ—¢æ²¡æœ‰å¢åŠ æ¥å£æ•°é‡ï¼Œä¹Ÿæ²¡æœ‰è¿”å›å¤šä½™çš„å†—ä½™ä¿¡æ¯ï¼Œä¸å¤šä¸å°‘ï¼Œè›®ç¾åŒ¹é…å‰ç«¯è¦æ±‚ã€‚å®Œç¾ï¼

# GraphQLå…·ä½“å·¥ä½œæµç¨‹
è¦å®ç°ä¸Šä¸€èŠ‚çš„åŸºäºå‰ç«¯çš„æŒ‰éœ€è·å–å­—æ®µè¦æ±‚ï¼ŒæœåŠ¡å™¨ç«¯éœ€è¦è¿›è¡ŒGraphQLæ”¹é€ æ‰èƒ½å®Œæˆã€‚

## GraphQLæœåŠ¡ç«¯æ”¹é€ 
GraphQLæœåŠ¡ç«¯éœ€è¦å®Œæˆç±»å‹å®šä¹‰ã€ç±»å‹æ“ä½œã€ç±»å‹è§£æä¸‰ä»¶äº‹æƒ…ã€‚

### ç±»å‹å®šä¹‰

é¦–å…ˆæ ¹æ®å­¦ç”Ÿè¡¨ç»“æ„ï¼Œå®šä¹‰ä¸€ä¸ªå­¦ç”Ÿç±»
```ts
  type Student {
    id: ID!
    name: String
    age: Int
    gender: Int
    intro: String
    phone: String
    address: String
  }
```
ä¸Šé¢å®šä¹‰çš„ç±»å‹å«åšGraphQLçš„å¯¹è±¡ç±»å‹ï¼Œå®ƒæ˜¯ç”¨GraphQL Schema Languageæ¥å®šä¹‰çš„ï¼Œæœ‰ç‚¹ç±»ä¼¼äºTypeScriptï¼Œä½†æ˜¯å’ŒTSç¨æœ‰ä¸åŒã€‚

è¿™é‡Œçš„`ID`ã€`Int`ã€`String`æ˜¯GraphQLçš„æ ‡é‡ç±»å‹ï¼Œå¯ä»¥ç†è§£ä¸ºGraphQLçš„åŸºæœ¬ç±»å‹ï¼Œå…¶ä¸­IDæ˜¯ä¸€ä¸ªä¸å¯é‡å¤çš„å­—ç¬¦ä¸²ï¼Œç±»ä¼¼äºä¸»é”®ï¼ŒIntå’ŒStringåˆ†åˆ«æ˜¯æ•´å½¢ã€‚ID!æ„Ÿå¹å·è¡¨ç¤ºIDä¸èƒ½ä¸ºç©ºã€‚

### ç±»å‹æ“ä½œ
å®šä¹‰å®Œå¯¹è±¡ç±»å‹ï¼Œè¿˜éœ€è¦å®šä¹‰ä¸€ä¸ªå­¦ç”Ÿåˆ—è¡¨çš„æŸ¥è¯¢æ“ä½œ
```ts
type Query {
    students: [Student]
}
```
Queryè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæŸ¥è¯¢æ“ä½œï¼Œé‡Œé¢å®šä¹‰äº†ä¸€ä¸ªstudentsçš„æ“ä½œç±»å‹ï¼Œå®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯ä¸Šé¢å®šä¸€ä¸ªçš„Studentç±»å‹ã€‚

è¿™æ ·ï¼Œæˆ‘ä»¬å®Œæˆäº†GraphQLçš„ç±»å‹å®šä¹‰ã€‚æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿ

### ç±»å‹è§£æ
æ“ä½œç±»å‹å®šä¹‰å®Œï¼Œå¦‚æœæ²¡æœ‰å®ç°æ“ä½œç±»å‹è§£æé€»è¾‘ï¼Œé‚£ä¹ˆè¿˜æ˜¯æ— æ³•ç›¸åº”å‰ç«¯çš„è¯·æ±‚ã€‚ç±»å‹è§£æå™¨ç›¸å…³çš„ä»£ç ç±»ä¼¼å¦‚ä¸‹ï¼š
```ts
const resolvers = {
    Query: {
        students: async () => {
            const list = await db.query('SELECT * FROM t_students')
            console.log(list)
            return list
        }
    }
}
```
è§£æå™¨çš„æ¥å£å’Œæ“ä½œç±»å‹çš„æ¥å£åŸºæœ¬ç±»ä¼¼ï¼Œåªä¸è¿‡å¢åŠ äº†å…·ä½“çš„è§£æé€»è¾‘ã€‚

## æœåŠ¡ç«¯å®Œæ•´ä»£ç 
apollo-serveræ˜¯ç¤¾åŒºå®ç°çš„GraphQLæœåŠ¡ç«¯åº“ï¼ŒåŸºäºapollo-serverï¼Œå­¦ç”Ÿåˆ—è¡¨çš„æœåŠ¡ç«¯çš„ä»£ç å¦‚ä¸‹ï¼š
```ts
// db.js
var mysql = require('mysql')
var dbConfig = require('./dbConfig') // é‡Œé¢çš„å†…å®¹éœ€è¦æ ¹æ®å„è‡ªæœ¬åœ°ç¯å¢ƒå…·ä½“é…ç½®
var connection = mysql.createConnection({
  host: dbConfig.host,
  user: dbConfig.user,
  password: dbConfig.password,
  database: dbConfig.database
})
module.exports = connection

//////////////////////

// server_graphql.js
const { ApolloServer, gql } = require('apollo-server')
const util = require('node:util');

const db = require('./db')
const port = 3002

db.connect()

// æ„é€ schema
const typeDefs = gql`
  type Query {
    students: [Student]
    student(id: ID!): Student
  }

  type Student {
    id: ID
    name: String
    age: Int
    gender: Int
    intro: String
    phone: String
    address: String
  }
`

db.query = util.promisify(db.query) // å°†æ•°æ®åº“æ“ä½œpromiseåŒ–
// å®šä¹‰resolver
const resolvers = {
  Query: {
    students: async () => {
      const list = await db.query('SELECT * FROM t_students')
      console.log(list)
      return list
    },
  }
}


const server = new ApolloServer({
  typeDefs,
  resolvers,
})

server.listen({port}).then(({ url }) => {
  console.log(`ğŸš€ Server ready at ${url}`);
});
```
ç®€å•è§£é‡Šä¸‹ä¸Šé¢çš„ä»£ç ã€‚æˆ‘ä»¬ç”¨åˆ°äº†apollo-serverçš„ä¸¤ä¸ªAPIï¼šgqlå’ŒApolloServerã€‚
- åœ¨Apollo Serverä¸­ï¼Œgql æ˜¯ä¸€ä¸ªç”¨äºå®šä¹‰ GraphQL æ¨¡å¼çš„æ ‡ç­¾å‡½æ•°ã€‚è¿™ä¸ªæ ‡ç­¾å‡½æ•°å¯ä»¥ç”¨äºåˆ›å»ºåŒ…å« GraphQL ç±»å‹å®šä¹‰çš„æ¨¡æ¿å­—ç¬¦ä¸²ã€‚ä½¿ç”¨ gql æ ‡ç­¾å‡½æ•°å¯ä»¥æ›´è½»æ¾åœ°åœ¨ JavaScript ä¸­ä¹¦å†™å’Œç»„ç»‡ GraphQL æ¨¡å¼ã€‚
- ApolloServer å‡½æ•°ç”¨æ¥åˆ›å»ºå’Œé…ç½® GraphQL æœåŠ¡å™¨å®ä¾‹çš„æ ¸å¿ƒæ„é€ å‡½æ•°ã€‚å®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼ŒGraphQLæ¨¡ç‰ˆå’ŒGraphqlè§£æå™¨ã€‚

å½“æˆ‘ä»¬è¿è¡Œåï¼Œé»˜è®¤ä¼šåœ¨æµè§ˆå™¨ç«¯å¼€å¯ä¸€ä¸ªGUIè°ƒè¯•ç¯å¢ƒã€‚

![](https://dsweiblog.oss-cn-shanghai.aliyuncs.com/technote/graphql-server2.gif)
å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨å·¦ä¾§è¾“å…¥æˆ‘ä»¬æƒ³è¦çš„å­—æ®µï¼Œå³ä¾§è¿”å›çš„ä¸ºå­—æ®µç›¸åº”çš„æ•°æ®ã€‚

## GraphQLå®¢æˆ·ç«¯
å®¢æˆ·ç«¯ä»£ç å…¶å®å¯ä»¥ç”¨ä¸åŒæ–¹å¼å®ç°ï¼Œç”šè‡³å¯ä»¥æ˜¯å‘½ä»¤è¡Œã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œå¯ä»¥åˆ©ç”¨apollo/clientæ¥å®ç°ä¸€ä¸ªç®€å•çš„åŸºäºreactçš„å®¢æˆ·ç«¯ã€‚
```ts
import { ApolloClient, InMemoryCache, gql } from "@apollo/client";
import { useEffect, useState } from "react";

function Students() {
  const [students, setStudents] = useState([])
  const allStudents = gql`
    query {
      students {
        id
        name
        address
      }
    }
  `
  const client = new ApolloClient({
    uri: 'http://localhost:3002/',
    cache: new InMemoryCache(),
  })

  useEffect(() => {
    client.query({
      query: allStudents
    }).then(res => {
      setStudents(res.data.students)
    })
  }, [])

  return (
    <>
      <h1>all students</h1>
      <ul>
        {students.map((item) => {
          return <li key={item.id}>{JSON.stringify(item)}</li>
        })}
      </ul>
    </>
  )
}

export default Students

```
è‡³æ­¤ï¼Œä¸€ä¸ªç›¸å¯¹ç®€å•ä¸”å®Œæ•´çš„graphQLå‰åç«¯demoå®Œæˆäº†ã€‚

# æ€»ç»“
GraphQLæ˜¯ä¸€ç§å‰ç«¯çš„æŸ¥è¯¢è¯­è¨€ï¼Œæ–¹ä¾¿å‰ç«¯é€šè¿‡å®šä¹‰è‡ªå·±éœ€è¦çš„å­—æ®µï¼Œæ¥å®ç°æ•°æ®çš„æŒ‰éœ€åŠ è½½ã€‚æœ¬æ–‡é€šè¿‡ä¸€ä¸ªç®€å•çš„æ•°æ®åˆ—è¡¨æ˜¾ç¤ºçš„ä¾‹å­ï¼Œå±•ç¤ºäº†ä¼ ç»ŸRestfulæ¥å£å’ŒGraphQLçš„å·®å¼‚ï¼ŒåŒæ—¶åˆ©ç”¨apollo-serverå’Œapllo/clientï¼Œå®é™…å±•ç¤ºäº†GraphQLçš„å‰åç«¯ç›¸å…³ç‰¹æ€§ã€‚
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶GraphQLåœ¨æ•°æ®çš„è·å–å’Œæ•°æ®åˆ©ç”¨ç‡ä¸Šï¼Œç›¸æ¯”RESTfulæœ‰æ˜æ˜¾çš„æå‡ï¼Œä½†é¡¹ç›®æ”¹é€ çš„æˆæœ¬ã€åå°æ•°æ®çš„ç¼“å­˜ã€æ•°æ®å®‰å…¨ç­‰é—®é¢˜ä¾ç„¶éœ€è¦è¿›ä¸€æ­¥æ¢è®¨å’Œæ·±ç©¶ã€‚
# ä»£ç 
æœ¬æ–‡ç›¸å…³çš„ä»£ç ï¼šhttps://github.com/wdskuki/js-tech-demo/tree/master/graphql